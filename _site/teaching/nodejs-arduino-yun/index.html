<!doctype html> <html class="no-js" lang="en"> <head> <meta charset="utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0" /> <title>NodeJS + Yun</title> <link rel="stylesheet" href="https://andysigler.github.io/assets/css/styles_feeling_responsive.css"> <script src="https://andysigler.github.io/assets/js/modernizr.min.js"></script> <script> WebFontConfig = { google: { families: [ 'Lato:400,700,400italic:latin', 'Volkhov::latin' ] } }; (function() { var wf = document.createElement('script'); wf.src = ('https:' == document.location.protocol ? 'https' : 'http') + '://ajax.googleapis.com/ajax/libs/webfont/1.5.6/webfont.js'; wf.type = 'text/javascript'; wf.async = 'true'; var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(wf, s); })(); </script> <noscript> <link href='http://fonts.googleapis.com/css?family=Lato:400,700,400italic%7cVolkhov' rel='stylesheet' type='text/css'> </noscript> <meta name="google-site-verification" content="" /> <meta name="msvalidate.01" content="" /> <meta name="description" content="Below are the steps to get NodeJS up and running on the Arduino Yun. This tutorial assumes you have already connected the Yun to your network, and have a basic understanding of NodeJS."/> <link rel="author" href=""/> <link rel="icon" sizes="32x32" href="https://andysigler.github.io/assets/img/favicon.ico"> <link rel="icon" sizes="192x192" href="https://andysigler.github.io/assets/img/touch-icon-192x192.png"> <link rel="apple-touch-icon-precomposed" sizes="180x180" href="https://andysigler.github.io/assets/img/apple-touch-icon-180x180-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://andysigler.github.io/assets/img/apple-touch-icon-152x152-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://andysigler.github.io/assets/img/apple-touch-icon-144x144-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://andysigler.github.io/assets/img/apple-touch-icon-120x120-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="114x114" href="https://andysigler.github.io/assets/img/apple-touch-icon-114x114-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://andysigler.github.io/assets/img/apple-touch-icon-76x76-precomposed.png"> <link rel="apple-touch-icon-precomposed" sizes="72x72" href="https://andysigler.github.io/assets/img/apple-touch-icon-72x72-precomposed.png"> <link rel="apple-touch-icon-precomposed" href="https://andysigler.github.io/assets/img/apple-touch-icon-precomposed.png"> <meta name="msapplication-TileImage" content="https://andysigler.github.io/assets/img/msapplication_tileimage.png"/> <meta name="msapplication-TileColor" content="#fabb00"> <!-- Facebook Optimization --> <meta property="og:locale" content="en_EN" /> <meta property="og:type" content="website" /> <meta property="og:title" content="NodeJS + Yun" /> <meta property="og:description" content="I make things."/> <meta property="og:url" content="https://andysigler.github.io/teaching/nodejs-arduino-yun/" /> <meta property="og:site_name" content="Andy Sigler" /> <!-- Search Engine Optimization --> <link type="text/plain" rel="author" href="https://andysigler.github.io/humans.txt" /> </head> <body id="top-of-page" class=""> <div id="navigation" class="sticky" style="z-index:1100;background-color:white;"> <nav class="top-bar row" data-topbar> <ul class="title-area"> <li class="name"> <h1 class="show-for-small-only"><a href="https://andysigler.github.io" class=""> </a></h1> </li> <!-- Remove the class "menu-icon" to get rid of menu icon. Take out "Menu" to just have icon alone --> <li class="toggle-topbar menu-icon"><a href="#"><span></span></a></li> </ul> <section class="top-bar-section"> <ul class="right"> <li class="divider"></li> <li><a href="https://andysigler.github.io/">Work</a></li> <li class="divider"></li> <li><a href="https://andysigler.github.io/blog/">Blog</a></li> <li class="divider"></li> <li><a href="https://andysigler.github.io/about/">About</a></li> </ul> <ul class="left"> </ul> </section> </nav> </div><!-- /#navigation --> <div id="masthead-no-image-header" class="noselect"> <div class="row"> <div class="small-10 small-offset-1 columns"> <a id="logo" href="https://andysigler.github.io" title="Andy Sigler – hardware & networked interaction"> <span class="matchbook noselect" id="nameLogo"></span> <br /> <span class="matchbook noselect" id="subLogo">hardware & networked interaction</span> </a> </div><!-- /.small-12.columns --> </div><!-- /.row --> </div><!-- /#masthead --> <div class="row t30"> <div class="medium-10 columns medium-offset-1 end"> <article itemscope itemtype="http://schema.org/Article"> <header> <span itemprop="name" class="avoidMe"> <div class="subheadline">Installing and Running NodeJS on the Arduino Yun</div><br /> <h1 class="matchbook" style="font-size:60px">NodeJS + Yun</h1> </span> </header> <p class="teaser" itemprop="description"> Below are the steps to get NodeJS up and running on the Arduino Yun. This tutorial assumes you have already connected the Yun to your network, and have a basic understanding of NodeJS. </p> <span itemprop="articleSection"> <p>Below are the steps to get NodeJS up and running on the Arduino Yun. This tutorial assumes you have already connected the Yun to your network, and have a basic understanding of NodeJS.</p> <p>The final steps (red section) of this tutorial are optional and should be taken with caution. They show how to disable Bridge on the Yun, in order to allow NodeJS to speak directly with the Arduino side of the board using node-serialport.</p> <p>This, however, means you can only access the Linux side of the board over the network. If you do not have control over the network between your computer and Yun, you will not be able to connect.</p> <h3 id="update-the-yuns-image">Update the Yun’s image</h3> <p>To do all the following, make sure you have updated your Yun to the latest image. This to to allow your Yun to have is disk space expanded in the next step.</p> <p><a href="http://arduino.cc/en/Tutorial/YunSysupgrade">Instructions on updating the Yun’s image</a></p> <h3 id="expand-disk-space-with-sd-card">Expand disk space with SD card</h3> <p>We will be moving the Yun’s operating system and memory onto a micro-sd card, so that we have enough room to install and run NodeJS.</p> <p><a href="http://arduino.cc/en/Tutorial/ExpandingYunDiskSpace">Instructions on expanding the Yun’s disk space</a></p> <h3 id="install-node-and-node-modules-with-opkg">Install Node and node-modules with opkg</h3> <p>With an updated Yun image and more memory, we can install Node using opkg (the Yun’s package management system). Be sure the Yun is connected to the internet.</p> <p>Enter the following line into the Yun to prepare opkg.</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">	opkg update</code></pre></figure> <p>After each call to opkg, you should see some lines about downloading and installing some files.</p> <p>Next install NodeJS with the following line.</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">opkg install node</code></pre></figure> <p>This may take a few moments. After it’s finished, install the pre-compiled node-modules using opkg.</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">opkg install node-ws
opkg install node-serialport</code></pre></figure> <p>There are a few other pre-compiled node-modules you can install through opkg. All modules are installed globally, so there is no need to ever run npm (especially because npm doesn’t work on the Yun…)</p> <h3 id="add-sftp-to-transfer-files">Add SFTP to transfer files</h3> <p>Uploading files to the Yun is much faster if you don’t have to turn it off every time. To do this, we have enable our Yun to be accessed over SFTP. Now, applications like CyberDuck can connect to and upload files to your Yun</p> <p>Enter the following line to install the SFTP package, and now you can connect to it using an FTP client like CyberDuck.</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">opkg update
opkg install openssh-sftp-server</code></pre></figure> <p>In CyberDuck, connect with SFTP, port 22, username ‘root’, and the server-name being your Yun’s IP address.</p> <p><img src="https://andysigler.github.io/images/cyberDuck_yun.png" alt="cyberDuck_yun" /></p> <p>I store all the node and web files on the micro-sd card, at <code>/mnt/sda1/arduino/node</code>. “sda1” is the external memory, “arduino” is a folder that should already exist, and “node” is a folder I created to store my Node scripts.</p> <p><img src="https://andysigler.github.io/images/cyberDuck_yun_2.png" alt="cyberDuck_yun_2" /></p> <p>Now you can upload and run NodeJS scripts on your Yun! See the below link for you can get NodeJS and the Arduino side of the Yun talking with Bridge:</p> <p><a href="http://www.tigoe.com/pcomp/code/arduinowiring/1216/#more-1216">Node.js on the Arduino Yun</a> - Tom Igoe’s example for getting NodeJS and the ATmega32U4 to communicate with Bridge.</p> <h3 id="give-the-ethernet-port-a-static-ip">Give the ethernet port a static IP</h3> <p>To my mind, the biggest disadvantage of removing Bridge from the Yun, is that you are taking away the ability to access the Linino through the ATmega32U4. This is especially helpul during initial setup, and while configuring the Yun’s network.</p> <p>To give some added security, I have chosen to give my Yun’s ethernet port a static, never changing IP address. With this, I can ssh into the Yun over an ethernet cable, using the following steps.</p> <p>We will edit a file to change the Yun’s network settings. The nano command opens it in terminal:</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">nano /etc/config/network</code></pre></figure> <p>If you get the error <code>Error opening terminal: xterm-256color.</code>, the following worked for me.</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">ln -s x /usr/share/terminfo/78
export TERM=xterm-color
nano /etc/config/network</code></pre></figure> <p>Find the part of the document that looks like this:</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">config interface 'wan'
   option iframe 'eth1'
   option proto 'dhcp'
   option metric '10'</code></pre></figure> <p>And change it to look like this:</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">config interface 'wan'
   option iframe 'eth1'
   option 'proto' 'static'
   option 'ipaddr' '192.168.0.200'
   option 'netmask' '255.255.255.0'
   option 'gateway' '192.168.0.1'
   option 'dns' '192.168.0.1'
   option metric '10'</code></pre></figure> <p>Instructions on the bottom show how to Write Out (save the file), and Exit.</p> <p>To Write Out (save your changes), hit <code>CONTROL-O</code>. It will ask if you want to save changes to this file, hit <code>ENTER</code> to save. To Exit hit <code>CONTROL-X</code>.</p> <p>Restart your Yun, and you will find it’s ethernet port has the permanent address <code>192.168.0.200</code>.</p> <p>In order to ssh into the Yun over an ethernet cable, your laptop’s ethernet IP address must share the same two first digits as the Yun’s IP. In this example, the laptop’s IP should beging width 192 and 168 in order for the two to communicate.</p> <p><img src="https://andysigler.github.io/images/staticEthernet_mac.png" alt="staticEthernet_mac" /></p> <p>On a Mac, I can go to <code>System Preferences &gt; Network</code>, select the ethernet port, and tell it to be a Manual IP Address (not DHCP). For example, I could set my laptop to be <code>192.168.0.42</code>.</p> <h3 id="disable-bridge-on-the-yun">Disable Bridge on the Yun</h3> <div class="alert-box radius alert"> Warning: Proceed with Caution! To disable Bridge and free the serial port between the Linux processor and the ATmega32U4, you simply have to comment out one line, and then restart the Yun. To bring Bridge back, simply uncomment the line, and restart the Yun. </div> <p>Open the file we must in edit in Terminal with the following command.</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">nano /etc/inittab</code></pre></figure> <p>If you get the error <code>Error opening terminal: xterm-256color.</code>, the following worked for me.</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">ln -s x /usr/share/terminfo/78
export TERM=xterm-color
nano /etc/inittab</code></pre></figure> <p>The nano command will open up a text editor in Terminal, where you can move around with the arrow keys.</p> <p>Find the line that says this:</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">ttyATH0::askfirst:/bin/ash --login</code></pre></figure> <p>And comment it out with pound sign at the beginning, like this:</p> <figure class="highlight"><pre><code class="language-html" data-lang="html">##### ttyATH0::askfirst:/bin/ash --login</code></pre></figure> <p>Instructions on the bottom show how to Write Out (save the file), and Exit.</p> <p>To Write Out (save your changes), hit <code>CONTROL-O</code>. It will ask if you want to save changes to this file, hit <code>ENTER</code> to save. To Exit hit <code>CONTROL-X</code>.</p> <p>Restart your Yun, and Bridge will not run. Once again, simply uncomment the line to bring Bridge back.</p> <h3 id="modify-code-and-run">Modify code and run</h3> <p>The Arduino on your Yun can now open a plain Serial connection to the Linux processor. However, it uses <code>Serial1</code> instead of <code>Serial</code>. <code>Serial</code> (without the 1) is connected to the micro-USB, and is used to upload code and communicate with a laptop.</p> <p>So to begin in your setup(), your Arduino code should read:</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="n">Serial1</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
<span class="k">while</span><span class="p">(</span><span class="o">!</span><span class="n">Serial1</span><span class="p">){}</span></code></pre></figure> <p>And to read and write, continue using <code>Serial1</code>:</p> <figure class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">while</span><span class="p">(</span><span class="n">Serial1</span><span class="p">.</span><span class="n">available</span><span class="p">()){</span>
   <span class="n">Serial1</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">Serial1</span><span class="p">.</span><span class="n">read</span><span class="p">());</span>
<span class="p">}</span>
<span class="n">Serial1</span><span class="p">.</span><span class="n">println</span><span class="p">();</span></code></pre></figure> <p>Any process running on Linux side of the board can access the Arduino’s serial port with the name <code>/dev/ttyATH0</code>.</p> <p>Now any NodeJS script using the node-serialport module can access the Atmel32u4 using port <code>/dev/ttyATH0</code>.</p> <h3 id="resources">Resources</h3> <p><a href="https://github.com/andySigler/NodeJS_Yun_Example">NodeJS_Yun_Example</a> - Some example code, showing a NodeJS server mediating the connection between a browser and an Arduino.</p> <p><a href="https://github.com/voodootikigod/node-serialport/blob/master/README.md">Reference for node-serialport</a> - Connect a Node script to the ATmega32U4</p> <p><a href="https://github.com/einaros/ws/blob/master/README.md">Reference for node-ws</a> - Run a WebSocket server on the Yun to have fast, real-time communication with a browser or other devices.</p> <p><a href="https://github.com/arduino/openwrt-packages-yun/tree/master/arduino">Node-modules available through opkg</a> - the repo containing all pre-compiled node-modules for the Yun. Others include Noble, Bleno, and socket.io.</p> <p><a href="http://www.tigoe.com/pcomp/code/arduinowiring/1216/#more-1216">Node.js on the Arduino Yun</a> - Tom Igoe’s example for getting NodeJS and the ATmega32U4 to communicate with Bridge. Its a bit of a hack that uses the stdin and stdout of a process.</p> </span> <div id="page-meta" class="t30"> <p> <!-- Look the author details up from the site config. --> <!-- Output author details if some exist. --> <time class="icon-calendar pr20" datetime="2014-11-14" itemprop="datePublished"> 2014-11-14</time> <span class="icon-archive pr20"> TEACHING</span> <br> <span class="pr20"><span class="icon-price-tag pr10"> blog</span> <span class="icon-price-tag pr10"> content</span> <span class="icon-price-tag pr10"> post</span> <span class="icon-price-tag pr10"> post format</span> </span> </p> <div id="post-nav" class="row"> <div class="small-5 columns"><a class="button small radius prev" href="https://andysigler.github.io/projects/how-to-make-the-internet-of-useless-things/">&laquo; ITP Master's Thesis</a></div><!-- /.small-4.columns --> <div class="small-5 columns text-right"><a class="button small radius next" href="https://andysigler.github.io/projects/patchbay-interface/">The Patchbay Interface &raquo;</a></div><!-- /.small-4.columns --> </div> <p><a href="https://andysigler.github.io/blog/archive/" title="Blog /blog/archive">/blog/archive</a></p><!-- /.small-4.columns --> </div><!-- /.page-meta --> </article> </div><!-- /.medium-8.columns --> </div><!-- /.row --> <script src="https://andysigler.github.io/assets/js/javascript.min.js"></script> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-57970756-2', 'auto'); ga('set', 'anonymizeIp', true); ga('send', 'pageview'); </script> </body> </html>
